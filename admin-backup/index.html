
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for k0rdent.">
      
      
        <meta name="author" content="Mirantis, Inc.">
      
      
      
        <link rel="prev" href="../admin-rbac/">
      
      
        <link rel="next" href="../user-create-cluster/">
      
      
      <link rel="icon" href="../img/favicon-32x32.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Backing up k0rdent - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#backing-up-and-restoring-a-k0rdent-management-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Documentation" class="md-header__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../img/k0rdent-logo-horizontal-inverted.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Backing up k0rdent
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/k0rdent/kcm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Documentation" class="md-nav__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../img/k0rdent-logo-horizontal-inverted.svg" alt="logo">

    </a>
    Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k0rdent/kcm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to the k0rdent docs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    k0rdent concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            k0rdent concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../why-k0rdent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Why k0rdent?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k0rdent-architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent architecture
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    QuickStarts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            QuickStarts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide-to-quickstarts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guide to Quickstarts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-1-mgmt-node-and-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set up Management Node and Cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-2-aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure and Deploy to AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-2-azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure and Deploy to Azure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Administrator Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Administrator Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-before/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Before you start
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing k0rdent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-prepare/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prepare k0rdent to create child clusters on multiple providers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-creating-clusters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating standalone clusters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-adopting-clusters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Adopting clusters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-hosted-control-planes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hosted control planes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-troubleshooting-aws-vpcs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting AWS VPCs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-service-templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using and creating service templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-create-multiclusterservice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating multi-cluster services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-kof/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent Observability & FinOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-upgrading-k0rdent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading k0rdent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent credentials management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../admin-rbac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent Role Based Access Control (RBAC)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Backing up k0rdent
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Backing up k0rdent
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#velero-as-provider-for-management-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Velero as Provider for Management Backups
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scheduled-management-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Management Backups
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scheduled Management Backups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Preparation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-management-backup" class="md-nav__link">
    <span class="md-ellipsis">
      Create a Management Backup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#management-backup-on-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Management Backup on Demand
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-included-in-the-management-backup" class="md-nav__link">
    <span class="md-ellipsis">
      What's Included in the Management Backup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restoration" class="md-nav__link">
    <span class="md-ellipsis">
      Restoration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Restoration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caveats" class="md-nav__link">
    <span class="md-ellipsis">
      Caveats
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upgrades-and-rollbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrades and rollbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upgrades and rollbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-management-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Management Backups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Rollbacks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caveats-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Caveats / Limitations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#velero-backups-restores-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Velero Backups / Restores deletion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Velero Backups / Restores deletion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-restores" class="md-nav__link">
    <span class="md-ellipsis">
      Delete Restores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Delete Backups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customization" class="md-nav__link">
    <span class="md-ellipsis">
      Customization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#velero-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Velero installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schedule-expression-format" class="md-nav__link">
    <span class="md-ellipsis">
      Schedule Expression Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#putting-extra-objects-in-a-management-backup" class="md-nav__link">
    <span class="md-ellipsis">
      Putting Extra Objects in a Management Backup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-create-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating clusters as a k0rdent user
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-create-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating and adding services to clusters as a k0rdent user
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../user-enable-drift-detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enabling drift detection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    k0rdent Templates Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            k0rdent Templates Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to k0rdent templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template-predefined/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Removing predefined templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template-byo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bring-your-own (BYO) templates
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template-aws/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for Amazon Web Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template-azure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for Azure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template-openstack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for OpenStack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template-vsphere/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Templates for vSphere
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Known Issues
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Known Issues
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../known-issues-eks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EKS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Appendix
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-extend-mgmt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extended management configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-dryrun/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding the dry run
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../appendix-providers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud provider credentials management in CAPI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k0rdent-documentation-contributors-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent documentation contributor's guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k0rdent-documentation-style-guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    k0rdent documentation style guide
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#velero-as-provider-for-management-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Velero as Provider for Management Backups
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scheduled-management-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Scheduled Management Backups
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scheduled Management Backups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparation" class="md-nav__link">
    <span class="md-ellipsis">
      Preparation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-management-backup" class="md-nav__link">
    <span class="md-ellipsis">
      Create a Management Backup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#management-backup-on-demand" class="md-nav__link">
    <span class="md-ellipsis">
      Management Backup on Demand
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#whats-included-in-the-management-backup" class="md-nav__link">
    <span class="md-ellipsis">
      What's Included in the Management Backup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restoration" class="md-nav__link">
    <span class="md-ellipsis">
      Restoration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Restoration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caveats" class="md-nav__link">
    <span class="md-ellipsis">
      Caveats
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upgrades-and-rollbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrades and rollbacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upgrades and rollbacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-management-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Management Backups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rollbacks" class="md-nav__link">
    <span class="md-ellipsis">
      Rollbacks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caveats-limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Caveats / Limitations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#velero-backups-restores-deletion" class="md-nav__link">
    <span class="md-ellipsis">
      Velero Backups / Restores deletion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Velero Backups / Restores deletion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delete-restores" class="md-nav__link">
    <span class="md-ellipsis">
      Delete Restores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Delete Backups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customization" class="md-nav__link">
    <span class="md-ellipsis">
      Customization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#velero-installation" class="md-nav__link">
    <span class="md-ellipsis">
      Velero installation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#schedule-expression-format" class="md-nav__link">
    <span class="md-ellipsis">
      Schedule Expression Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#putting-extra-objects-in-a-management-backup" class="md-nav__link">
    <span class="md-ellipsis">
      Putting Extra Objects in a Management Backup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="backing-up-and-restoring-a-k0rdent-management-cluster">Backing Up and Restoring a k0rdent Management Cluster<a class="headerlink" href="#backing-up-and-restoring-a-k0rdent-management-cluster" title="Permanent link">#</a></h1>
<p>Any production system needs to provide Disaster Recovery features, and the heart of these capabilities is the ability to
perform backup and restore operations. In this chapter we'll look at backing up and restoring k0rdent management cluster
so that in case of an emergency, you can restore your system to its previous condition or recreate it on another cluster.</p>
<p>While it's possible to back up a Kubernetes cluster manually, it's better to build on the work
of others. In this case we're going to leverage the <a href="https://velero.io/"><code>velero</code></a> project for backup management
on the backend and see how it integrates with k0rdent to ensure data persistence and recovery.</p>
<h2 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">#</a></h2>
<p>The primary goal of this feature is to provide a reliable and efficient way to back up and restore
a k0rdent deployment in the event of a disaster that impacts the management cluster.
By using <code>velero</code> as the backup provider, we can create consistent backups across
different cloud storage options while maintaining the integrity of critical resources.</p>
<p>The main goal of the feature is to provide:</p>
<ul>
<li><strong>Management Backup:</strong> The ability to backup all configuration objects created and managed by k0rdent, including
  into an offsite location.</li>
<li><strong>Restore:</strong> The ability to create configuration objects from a specific Management Backup in order to create a management
  cluster in the same state that existed at the time of backup without (re)provisioning of cloud resources.</li>
<li><strong>Disaster Recovery:</strong> The ability to restore k0rdent on another management cluster, plus ensuring that clusters are not
  recreated or lost.</li>
<li><strong>Rollback:</strong> The possibility to manually restore after a specific event, such as a failed k0rdent upgrade</li>
</ul>
<h2 id="velero-as-provider-for-management-backups">Velero as Provider for Management Backups<a class="headerlink" href="#velero-as-provider-for-management-backups" title="Permanent link">#</a></h2>
<p><a href="https://velero.io/"><code>Velero</code></a> is an open-source tool that simplifies backing up and restoring clusters as well as individual resources. It seamlessly integrates into the k0rdent management environment to provide robust disaster recovery capabilities.</p>
<p>The <code>velero</code> instance is part of the Helm chart that installs k0rdent, which means that it
can be <a href="#velero-installation">customized</a> if necessary.</p>
<p>k0rdent manages the schedule and is responsible for collecting data to be included in a backup.</p>
<h2 id="scheduled-management-backups">Scheduled Management Backups<a class="headerlink" href="#scheduled-management-backups" title="Permanent link">#</a></h2>
<p>Backups should be scheduled on a regular basis, depending on how often information changes.</p>
<h3 id="preparation">Preparation<a class="headerlink" href="#preparation" title="Permanent link">#</a></h3>
<p>Before you create a scheduled backup, you need to perform a few preparatory steps:</p>
<ol>
<li>
<p>If no <code>velero</code> plugins have been installed as suggested
   in the <a href="#velero-installation">corresponding section</a>,
   install it by modifying the <code>Management</code> object:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k0rdent.mirantis.com/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Management</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ... </span>
<span class="w">  </span><span class="nt">core</span><span class="p">:</span>
<span class="w">    </span><span class="nt">kcm</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="nt">velero</span><span class="p">:</span>
<span class="w">          </span><span class="nt">initContainers</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero-plugin-for-&lt;provider-name&gt;</span>
<span class="w">            </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero/velero-plugin-for-&lt;provider-name&gt;:&lt;provider-plugin-tag&gt;</span>
<span class="w">            </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="w">            </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/target</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plugins</span>
<span class="w">  </span><span class="c1"># ...</span>
</code></pre></div>
</li>
<li>
<p>Prepare a cloud storage location, such as an Amazon S3 bucket, to which to save backups.</p>
</li>
<li>
<p>Create a <a href="https://velero.io/docs/v1.15/api-types/backupstoragelocation/"><code>BackupStorageLocation</code></a>
   object referencing a <code>Secret</code> with credentials to access the cloud storage
   (if the multiple credentials feature is supported by the plugin).</p>
<p>For example, if you are using Amazon S3, your <code>BackupStorageLocation</code> and the related <code>Secret</code> might look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># base64-encoded credentials for Amazon S3 in the following format:</span>
<span class="w">  </span><span class="c1"># [default]</span>
<span class="w">  </span><span class="c1"># aws_access_key_id = EXAMPLE_ACCESS_KEY_ID</span>
<span class="w">  </span><span class="c1"># aws_secret_access_key = EXAMPLE_SECRET_ACCESS_KEY</span>
<span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">WW2RlZmF1bHRdCmF3c19hY2Nlc3Nfa2V5X2lkID0gRVhBTVBMRV9BQ0NFU1NfS0VZX0lECmF3c19zZWNyZXRfYWNjZXNzX2tleSA9IEVYQU1QTEVfU0VDUkVUX0FDQ0VTU19LRVkKICA=</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloud-credentials</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BackupStorageLocation</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-s3</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your-region-name&gt;</span>
<span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># optional, if not set, then storage location name must always be set in ManagementBackup</span>
<span class="w">  </span><span class="nt">objectStorage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bucket</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your-bucket-name&gt;</span>
<span class="w">  </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws</span>
<span class="w">  </span><span class="nt">backupSyncPeriod</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<span class="w">  </span><span class="nt">credential</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloud-credentials</span>
<span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloud</span>
</code></pre></div>
</li>
</ol>
<p>You can get more information on how to build these objects at the <a href="https://velero.io/docs/v1.15/locations">official Velero documentation</a>.</p>
<h3 id="create-a-management-backup">Create a Management Backup<a class="headerlink" href="#create-a-management-backup" title="Permanent link">#</a></h3>
<p>Periodic backups are handled by a <code>ManagementBackup</code> object, which uses a <a href="https://en.wikipedia.org/wiki/Cron">Cron</a> expression
for its <code>.spec.schedule</code> field.
If the <code>.spec.schedule</code> field is not set, a <a href="#management-backup-on-demand">backup on demand</a> will be created instead.</p>
<p>Optionally, set the name of the <code>BackupStorageLocation</code> <code>.spec.backup.storageLocation</code>.
The default location is the <code>BackupStorageLocation</code> object with <code>.spec.default</code> set to <code>true</code>.</p>
<p>For example, you can create a <code>ManagementBackup</code> object that backs up to the storage object created in the previous step
every 6 minutes would look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k0rdent.mirantis.com/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ManagementBackup</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0</span><span class="nv"> </span><span class="s">*/6</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span>
<span class="w">  </span><span class="nt">storageLocation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-s3</span>
</code></pre></div>
<h2 id="management-backup-on-demand">Management Backup on Demand<a class="headerlink" href="#management-backup-on-demand" title="Permanent link">#</a></h2>
<p>To create a single backup of the existing k0rdent management cluster information, you can create a <code>ManagementBackup</code> object
using a YAML document and the <code>kubectl</code> CLI. The object then creates only one instance of a backup. For example you can backup
to the location created earlier:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k0rdent.mirantis.com/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ManagementBackup</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-backup</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">storageLocation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">aws-s3</span>
</code></pre></div>
<h2 id="whats-included-in-the-management-backup">What's Included in the Management Backup<a class="headerlink" href="#whats-included-in-the-management-backup" title="Permanent link">#</a></h2>
<p>The backup includes all of k0rdent <code>kcm</code> component resources, parts of the <code>cert-manager</code>
components required for other components creation, and all the required resources
of <code>CAPI</code> and the <code>ClusterDeployment</code>s currently in use in the management cluster.</p>
<p>By default, objects satisfying these labels will be included in the backup:</p>
<div class="highlight"><pre><span></span><code>cluster.x-k8s.io/cluster-name=&quot;&lt;cluster-deployment-name&gt;&quot;
helm.toolkit.fluxcd.io/name=&quot;&lt;cluster-deployment-name&gt;&quot;

cluster.x-k8s.io/provider=&quot;bootstrap-&lt;provider&gt;&quot;
cluster.x-k8s.io/provider=&quot;control-plane-&lt;provider&gt;&quot;
cluster.x-k8s.io/provider=&quot;infrastructure-&lt;provider&gt;&quot;

cluster.x-k8s.io/provider=&quot;cluster-api&quot;

controller.cert-manager.io/fao=&quot;true&quot;

k0rdent.mirantis.com/component=&quot;kcm&quot;
</code></pre></div>
<p>An example sorted set of labels, objects satisfying these labels will
be included in the backup:</p>
<div class="highlight"><pre><span></span><code>cluster.x-k8s.io/cluster-name=&quot;some-cluster-deployment-name&quot;
cluster.x-k8s.io/provider=&quot;bootstrap-k0sproject-k0smotron&quot;
cluster.x-k8s.io/provider=&quot;cluster-api&quot;
cluster.x-k8s.io/provider=&quot;control-plane-k0sproject-k0smotron&quot;
cluster.x-k8s.io/provider=&quot;infrastructure-aws&quot;
controller.cert-manager.io/fao=&quot;true&quot;
helm.toolkit.fluxcd.io/name=&quot;some-cluster-deployment-name&quot;
k0rdent.mirantis.com/component=&quot;kcm&quot;
</code></pre></div>
<h2 id="restoration">Restoration<a class="headerlink" href="#restoration" title="Permanent link">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>
Please refer to the
<a href="https://velero.io/docs/v1.15/migration-case/#before-migrating-your-cluster">official migration documentation</a>
to familiarize yourself with potential limitations of the Velero backup system.</p>
</div>
<p>In the event of disaster, you can restore from a backup by doing the following:</p>
<ol>
<li>
<p>Create a clean k0rdent installation, including <code>velero</code> and <a href="#velero-installation">its plugins</a>.
   Specifically, you want to <strong>avoid</strong> creating a <code>Management</code> object and similar objects because they
   will be part of your restored cluster. You can remove these objects after installation, but you
   can also install k0rdent without them in the first place:</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>install<span class="w"> </span>kcm<span class="w"> </span>oci://ghcr.io/k0rdent/kcm/charts/kcm<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--version<span class="w"> </span>&lt;version&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--namespace<span class="w"> </span>kcm-system<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>controller.createManagement<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>controller.createAccessManagement<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>controller.createRelease<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>controller.createTemplates<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.initContainers<span class="o">[</span><span class="m">0</span><span class="o">]</span>.name<span class="o">=</span>velero-plugin-for-&lt;provider-name&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.initContainers<span class="o">[</span><span class="m">0</span><span class="o">]</span>.image<span class="o">=</span>velero/velero-plugin-for-&lt;provider-name&gt;:&lt;provider-plugin-tag&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.initContainers<span class="o">[</span><span class="m">0</span><span class="o">]</span>.volumeMounts<span class="o">[</span><span class="m">0</span><span class="o">]</span>.mountPath<span class="o">=</span>/target<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.initContainers<span class="o">[</span><span class="m">0</span><span class="o">]</span>.volumeMounts<span class="o">[</span><span class="m">0</span><span class="o">]</span>.name<span class="o">=</span>plugins
</code></pre></div>
</li>
<li>
<p>Create the <code>BackupStorageLocation</code>/<code>Secret</code> objects that were created during the <a href="#preparation">preparation stage</a>
   of creating a backup (preferably the same depending on a plugin).</p>
</li>
<li>
<p>Restore the <code>kcm</code> system creating the <a href="https://velero.io/docs/v1.15/api-types/restore/"><code>Restore</code></a> object.
   Note that it is important to set the <code>.spec.existingResourcePolicy</code> field value to <code>update</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restore</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;restore-name&gt;</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">backupName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;backup-name&gt;</span>
<span class="w">  </span><span class="nt">existingResourcePolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update</span>
<span class="w">  </span><span class="nt">includedNamespaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
</code></pre></div>
</li>
<li>
<p>Wait until the <code>Restore</code> status is <code>Completed</code> and all <code>kcm</code> components are up and running.</p>
</li>
</ol>
<h3 id="caveats">Caveats<a class="headerlink" href="#caveats" title="Permanent link">#</a></h3>
<p>For some CAPI providers it is necessary to make changes to the <code>Restore</code>
object due to the large number of different resources and logic in each provider.
The resources described below are not excluded from a <code>ManagementBackup</code> by
default to avoid logical dependencies on one or another provider, and to create a provider-agnostic system.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>
The described caveats apply only to the <code>Restore</code>
object creation step and do not affect the other steps.</p>
</div>
<h4 id="azure-capz">Azure (CAPZ)<a class="headerlink" href="#azure-capz" title="Permanent link">#</a></h4>
<p>The following resources should be excluded from the <code>Restore</code> object:</p>
<ul>
<li><code>natgateways.network.azure.com</code></li>
<li><code>resourcegroups.resources.azure.com</code></li>
<li><code>virtualnetworks.network.azure.com</code></li>
<li><code>virtualnetworkssubnets.network.azure.com</code></li>
</ul>
<p>Due to the <a href="https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definition-versioning/#webhook-conversion">webhook conversion</a>,
objects of these resources cannot be restored, and they will
be created in the management cluster by the <code>CAPZ</code> provider
automatically with the same <code>spec</code> as in the backup.</p>
<p>The resulting <code>Restore</code> object:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restore</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;restore-name&gt;</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">backupName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;backup-name&gt;</span>
<span class="w">  </span><span class="nt">existingResourcePolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update</span>
<span class="w">  </span><span class="nt">excludedResources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">natgateways.network.azure.com</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resourcegroups.resources.azure.com</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtualnetworks.network.azure.com</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">virtualnetworkssubnets.network.azure.com</span>
<span class="w">  </span><span class="nt">includedNamespaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
</code></pre></div>
<h4 id="vsphere-capv">vSphere (CAPV)<a class="headerlink" href="#vsphere-capv" title="Permanent link">#</a></h4>
<p>The following resources should be excluded from the <code>Restore</code> object:</p>
<ul>
<li><code>mutatingwebhookconfiguration.admissionregistration.k8s.io</code></li>
<li><code>validatingwebhookconfiguration.admissionregistration.k8s.io</code></li>
</ul>
<p>Due to the <a href="https://velero.io/docs/v1.15/restore-reference/#restore-order">Velero Restoration Order</a>,
some of the <code>CAPV</code> core objects cannot be restored,
and they will not be recreated automatically.
Because all of the objects have already passed both mutations
and validations, there is not much sense in validating them again.
The webhook configurations will be restored during installation
of the <code>CAPV</code> provider.</p>
<p>The resulting <code>Restore</code> object:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restore</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;restore-name&gt;</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">backupName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;backup-name&gt;</span>
<span class="w">  </span><span class="nt">existingResourcePolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update</span>
<span class="w">  </span><span class="nt">excludedResources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mutatingwebhookconfiguration.admissionregistration.k8s.io</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">validatingwebhookconfiguration.admissionregistration.k8s.io</span>
<span class="w">  </span><span class="nt">includedNamespaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
</code></pre></div>
<h2 id="upgrades-and-rollbacks">Upgrades and rollbacks<a class="headerlink" href="#upgrades-and-rollbacks" title="Permanent link">#</a></h2>
<p>The Disaster Recovery Feature provides a way to create backups
on each <code>kcm</code> upgrade automatically.</p>
<h3 id="automatic-management-backups">Automatic Management Backups<a class="headerlink" href="#automatic-management-backups" title="Permanent link">#</a></h3>
<p>Each <code>ManagementBackup</code> with a <em>non-empty</em> <code>.spec.schedule</code> field
can enable the automatic creation of backups before
<a href="../admin-upgrading-k0rdent/">upgrading</a> to a new version.</p>
<p>To enable, set the <code>.spec.performOnManagementUpgrade</code> to <code>true</code>.</p>
<p>For example, a <code>ManagementBackup</code> object with enabled auto-backup before the <code>kcm</code> version upgrade looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k0rdent.mirantis.com/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ManagementBackup</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example-backup</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0</span><span class="nv"> </span><span class="s">*/6</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span>
<span class="w">  </span><span class="nt">performOnManagementUpgrade</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>After the enablement, before each upgrade of <code>kcm</code> to a new version,
a new backup will be created.</p>
<p>Automatically created backups have the
following name template to make it easier to find them:
the name of the <code>ManagementBackup</code> object with enabled <code>performOnManagementUpgrade</code>
concatenates with the name of the release before the upgrade,
for example, <code>example-backup-kcm-0-1-0</code>.</p>
<p>Automatically created backups have the label <code>k0rdent.mirantis.com/release-backup</code>
with the name of the release before the upgrade as its value
to simplify querying if required.</p>
<h3 id="rollbacks">Rollbacks<a class="headerlink" href="#rollbacks" title="Permanent link">#</a></h3>
<p>If during the <code>kcm</code> upgrade a failure happens, a rollback operation
should be performed to restore the <code>kcm</code> to its before-the-upgrade state:</p>
<ol>
<li>
<p>Follow the first 2 steps from the <a href="#restoration">restoration section</a>, creating a clean <code>kcm</code>
   installation and <code>BackupStorageLocation</code>/<code>Secret</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>
Please consider the <a href="#caveats">restoration caveats</a> section before proceeding.</p>
</div>
</li>
<li>
<p>Create the <code>ConfigMap</code> object with patches to revert the <code>Management</code>
   <code>.spec.release</code>, substitute the <code>&lt;version-before-upgrade&gt;</code> with
   the version of <code>kcm</code> before the upgrade, and create the <code>Restore</code> object,
   propagating the <code>ConfigMap</code> to it:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">patch-mgmt-spec-release</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">version: v1</span>
<span class="w">    </span><span class="no">resourceModifierRules:</span>
<span class="w">    </span><span class="no">- conditions:</span>
<span class="w">        </span><span class="no">groupResource: managements.k0rdent.mirantis.com</span>
<span class="w">      </span><span class="no">patches:</span>
<span class="w">      </span><span class="no">- operation: replace</span>
<span class="w">        </span><span class="no">path: &quot;/spec/release&quot;</span>
<span class="w">        </span><span class="no">value: &quot;&lt;version-before-upgrade&gt;&quot;</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch-mgmt-spec-release</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Restore</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;restore-name&gt;</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">backupName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;backup-name&gt;</span>
<span class="w">  </span><span class="nt">existingResourcePolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">update</span>
<span class="w">  </span><span class="nt">includedNamespaces</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
<span class="w">  </span><span class="nt">resourceModifier</span><span class="p">:</span><span class="w"> </span><span class="c1"># propagate patches</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch-mgmt-spec-release</span>
</code></pre></div>
</li>
<li>
<p>Wait until the <code>Restore</code> status is <code>Completed</code> and all <code>kcm</code> components are up and running.</p>
</li>
<li>Optionally delete the created <code>ConfigMap</code>.</li>
</ol>
<h2 id="caveats-limitations">Caveats / Limitations<a class="headerlink" href="#caveats-limitations" title="Permanent link">#</a></h2>
<p>The credentials stored in backups can and will get stale,
so a proper rotation should be considered beforehand.</p>
<p>All <code>velero</code> caveats and limitations are transitively implied in <code>k0rdent</code>. In particular, that
means no backup encryption is provided until it is implemented by a <code>velero</code> plugin that supports
encryption and cloud storage backups.</p>
<h2 id="velero-backups-restores-deletion">Velero Backups / Restores deletion<a class="headerlink" href="#velero-backups-restores-deletion" title="Permanent link">#</a></h2>
<h3 id="delete-restores">Delete Restores<a class="headerlink" href="#delete-restores" title="Permanent link">#</a></h3>
<p>To delete a <code>velero</code> <code>Restore</code> from the management cluster
<strong>and</strong> from cloud storage, delete <code>restores.velero.io</code> object(s),
such as with the following command:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>restores.velero.io<span class="w"> </span>-n<span class="w"> </span>kcm-system<span class="w"> </span>&lt;restore-name&gt;
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>
Deletion of a <code>Restore</code> object deletes it from both
the management cluster and from cloud storage.</p>
</div>
<h3 id="delete-backups">Delete Backups<a class="headerlink" href="#delete-backups" title="Permanent link">#</a></h3>
<p>To remove a <code>velero</code> <code>Backup</code> from the management cluster,
delete <code>backups.velero.io</code> object(s), such as with the following command:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>delete<span class="w"> </span>backups.velero.io<span class="w"> </span>-n<span class="w"> </span>kcm-system<span class="w"> </span>&lt;velero-backup-name&gt;
</code></pre></div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>
The command above only removes objects from
the cluster; the data continues to persist
on the cloud storage.</p>
<p>The deleted object will be recreated in the
cluster if its <code>BackupStorageLocation</code> <code>.spec.backupSyncPeriod</code>
is set and does not equal <code>0</code>.</p>
</div>
<p>To delete a <code>velero</code> <code>Backup</code> from the management cluster
<strong>and</strong> from cloud storage, create the following <code>DeleteBackupRequest</code> object:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DeleteBackupRequest</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delete-backup-completely</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm-system</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">backupName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;velero-backup&gt;</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>
Deletion of a <code>Backup</code> object via the <code>DeleteBackupRequest</code>
deletes it from both
the management cluster and from the cloud storage.</p>
</div>
<p>Optionally, delete the created <code>DeleteBackupRequest</code> object
from the cluster after <code>Backup</code> has been deleted.</p>
<p>For reference, follow the <a href="https://velero.io/docs/v1.15/backup-reference/#deleting-backups">official documentation</a>.</p>
<h2 id="customization">Customization<a class="headerlink" href="#customization" title="Permanent link">#</a></h2>
<p>This section covers different topics of customization regarding backing up and restoring k0rdent.</p>
<h3 id="velero-installation">Velero installation<a class="headerlink" href="#velero-installation" title="Permanent link">#</a></h3>
<p>The Velero helm chart is supplied with the
<a href="https://vmware-tanzu.github.io/helm-charts/">k0rdent helm chart</a>
and is enabled by default. There are 2 ways of customizing the chart values:</p>
<ol>
<li>
<p>Install using <code>helm</code> and add corresponding parameters to the <code>helm install</code> command.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>
Only a plugin is required during restoration; the other parameters
are optional.</p>
</div>
<p>For example, this command installs k0rdent via <code>helm install</code> with a configured plugin, <code>BackupStorageLocation</code>
and propagated credentials:</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>install<span class="w"> </span>kcm<span class="w"> </span>oci://ghcr.io/k0rdent/kcm/charts/kcm<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--version<span class="w"> </span>&lt;version&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--create-namespace<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--namespace<span class="w"> </span>kcm-system<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set-file<span class="w"> </span>velero.credentials.secretContents.cloud<span class="o">=</span>&lt;FULL<span class="w"> </span>PATH<span class="w"> </span>TO<span class="w"> </span>FILE&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.credentials.useSecret<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.backupsEnabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.configuration.backupStorageLocation<span class="o">[</span><span class="m">0</span><span class="o">]</span>.name<span class="o">=</span>&lt;backup-storage-location-name&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.configuration.backupStorageLocation<span class="o">[</span><span class="m">0</span><span class="o">]</span>.provider<span class="o">=</span>&lt;provider-name&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.configuration.backupStorageLocation<span class="o">[</span><span class="m">0</span><span class="o">]</span>.bucket<span class="o">=</span>&lt;bucket-name&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.configuration.backupStorageLocation<span class="o">[</span><span class="m">0</span><span class="o">]</span>.config.region<span class="o">=</span>&lt;region&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.initContainers<span class="o">[</span><span class="m">0</span><span class="o">]</span>.name<span class="o">=</span>velero-plugin-for-&lt;provider-name&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.initContainers<span class="o">[</span><span class="m">0</span><span class="o">]</span>.image<span class="o">=</span>velero/velero-plugin-for-&lt;provider-name&gt;:&lt;provider-plugin-tag&gt;<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.initContainers<span class="o">[</span><span class="m">0</span><span class="o">]</span>.volumeMounts<span class="o">[</span><span class="m">0</span><span class="o">]</span>.mountPath<span class="o">=</span>/target<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--set<span class="w"> </span>velero.initContainers<span class="o">[</span><span class="m">0</span><span class="o">]</span>.volumeMounts<span class="o">[</span><span class="m">0</span><span class="o">]</span>.name<span class="o">=</span>plugins
</code></pre></div>
</li>
<li>
<p>Create or modify the existing <code>Management</code> object in the <code>.spec.config.kcm</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>
Only a plugin is required during restoration; the other parameters
are optional.</p>
</div>
<p>For example, this is a <code>Management</code> object with a configured plugin and enabled metrics:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k0rdent.mirantis.com/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Management</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kcm</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># ...</span>
<span class="w">  </span><span class="nt">core</span><span class="p">:</span>
<span class="w">    </span><span class="nt">kcm</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span>
<span class="w">        </span><span class="nt">velero</span><span class="p">:</span>
<span class="w">          </span><span class="nt">initContainers</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero-plugin-for-&lt;provider-name&gt;</span>
<span class="w">            </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velero/velero-plugin-for-&lt;provider-name&gt;:&lt;provider-plugin-tag&gt;</span>
<span class="w">            </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="w">            </span><span class="nt">volumeMounts</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/target</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plugins</span>
<span class="w">          </span><span class="nt">metrics</span><span class="p">:</span>
<span class="w">            </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="c1"># ...</span>
</code></pre></div>
</li>
</ol>
<p>To fully disable <code>velero</code>, set the <code>velero.enabled</code> parameter to <code>false</code>.</p>
<h3 id="schedule-expression-format">Schedule Expression Format<a class="headerlink" href="#schedule-expression-format" title="Permanent link">#</a></h3>
<p>The <code>ManagementBackup</code> <code>.spec.schedule</code> field accepts a correct
<a href="https://en.wikipedia.org/wiki/Cron">Cron</a> expression,
along with the
<a href="https://en.wikipedia.org/wiki/Cron#Nonstandard_predefined_scheduling_definitions">nonstandard predefined scheduling definitions</a>
and an extra definition <code>@every</code> with a number and a valid time unit
(valid time units are <code>ns</code>, <code>us</code> (or <code>µs</code>), <code>ms</code>, <code>s</code>, <code>m</code>, <code>h</code>).</p>
<p>The following list contains acceptable <code>.spec.schedule</code> example values:</p>
<ul>
<li><code>0 */1 * * *</code> (standard Cron expression)</li>
<li><code>@hourly</code> (nonstandard predefined definition)</li>
<li><code>@every 1h</code> (extra definition)</li>
</ul>
<h3 id="putting-extra-objects-in-a-management-backup">Putting Extra Objects in a Management Backup<a class="headerlink" href="#putting-extra-objects-in-a-management-backup" title="Permanent link">#</a></h3>
<p>If you need to back up objects other than those <a href="./#whats-included-in-the-management-backup">backed up by default</a>,
you can add the label <code>k0rdent.mirantis.com/component="kcm"</code> to these objects.</p>
<p>All objects containing the label will be automatically added to the management backup.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 The k0rdent authors | Documentation distributed under <a href="https://creativecommons.org/licenses/by/4.0/legalcode.txt">CC-BY-4.0</a>.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k0rdent/kcm" target="_blank" rel="noopener" title="k0rdent on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://x.com/k0rdent" target="_blank" rel="noopener" title="k0rdent on X" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://bsky.app/profile/k0rdent.bsky.social" target="_blank" rel="noopener" title="k0rdent on BlueSky" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2 42.1-31.6 110.3-56 110.3 21.8 0 15.5-8.9 130.5-14.1 149.2-18.2 64.8-84.4 81.4-143.3 71.3C456 322 482.2 380 425.6 438c-107.4 110.2-154.3-27.6-166.3-62.9-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8c-12 35.3-59 173.1-166.3 62.9-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1 10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.youtube.com/channel/UChXQ6kbvjnAtdZAQpl7Fo4A" target="_blank" rel="noopener" title="k0rdent on YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/company/k0rdent/" target="_blank" rel="noopener" title="k0rdent on LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["toc.autohide", "search.suggest", "search.highlight", "content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>